{% extends "helios/templates/cryptobase.html" %}

{% block title %}Trustees für {{election.name}}{% endblock %}

{% block content %}
  <h3 class="title">{{election.name}} &mdash; Trustees <span style="font-size:0.7em;">[<a href="{% url "election@view" election.uuid %}">zurück zur Wahl</a>]</span></h3>

<p>
    Trustees sind für die Entschlüsselung des Wahlergebnisses verantwortlich.<br />
    Jeder Trustee erzeugt ein Schlüsselpaar und übermittelt den öffentlichen Teil an Helios.<br />
    Wenn es Zeit zum Entschlüsseln ist, muss jeder Trustee seinen geheimen Schlüssel angeben.
</p>

{% if not election.frozen_at %}

<p>
  Helios ist automatisch Ihr erster Trustee und wird die Generierung seines Schlüsselpaares und die Entschlüsselung automatisch handhaben.<br />
  Sie können bei Bedarf zusätzliche Trustees hinzufügen und sogar den Helios Trustee entfernen.<br />
  Wir empfehlen Ihnen jedoch, dies nur zu tun, wenn Sie die Rolle des Trustees genau verstehen.
</p>

{% if admin_p %}
<p>
    [ <a onclick="return(confirm('Das Hinzufügen eines eigenen Trustees erfordert etwas mehr Arbeit, um die Wahl auszuzählen.\nSie müssen die Trustees Schlüsselpaare erzeugen lassen und deren geheimen Schlüssel sichern.\n\nWenn Sie nicht sicher sind, was das bedeutet, empfehlen wir dringend,\nauf Abbrechen zu klicken und Helios die Wahl für Sie auszählen zu lassen.'));" href="{% url "election@trustees@new" election.uuid %}">einen Trustee hinzufügen</a> ]
</p>
{% if not election.has_helios_trustee %}
<p>
    <a href="{% url "election@trustees@add-helios" election.uuid %}">Helios als Trustee hinzufügen</a>
</p>
{% endif %}
{% endif %}

{% endif %}

{% if not trustees|length %}

{% else %}
{% for t in trustees %}
<h5> Trustee Nr. {{forloop.counter}}: {{t.name}} 
{% if admin_p %}
{% if t.secret_key %}
{% if not election.frozen_at %}[<a onclick="return confirm('Sind Sie sicher, dass Sie Helios als Trustee entfernen möchten?');" href="{% url "election@trustees@delete" election.uuid %}?uuid={{t.uuid}}">x</a>]{% endif %}
{% else %}
({{t.email}})
{% if not election.frozen_at %}[<a onclick="return confirm('Sind Sie sicher, dass Sie diesen Trustee entfernen möchten?');" href="{% url "election@trustees@delete" election.uuid %}?uuid={{t.uuid}}">x</a>]{% endif %}
[<a onclick="return confirm('Sind Sie sicher, dass Sie diesem Trustee seinen/ihren Admin-Link senden möchten?');" href="{% url "election@trustee@send-url" election.uuid t.uuid %}">Anmelde-Link senden</a>]
{% endif %}
{% endif %}
</h5>

<p>
{% if t.public_key_hash %}
    Hash des öffentlichen Schlüssels: 
    <tt style="font-size:1.5em; overflow-x:auto; display:inline-block; max-width:100%;">{{t.public_key_hash}}</tt>
{% else %}
Es wurde noch kein öffentlicher Schlüssel hochgeladen.
{% endif %}
</p>

{% if election.encrypted_tally %}
{% if t.decryption_factors %}
<b>Auszählung für diesen Trustee aufgezeichnet.</b>
{% else %}
<em>wartet auf die Auszählung dieses Trustees</em>
{% endif %}
{% endif %}
</li>
{% endfor %}
</ul>

{% endif %}

{% endblock %}
